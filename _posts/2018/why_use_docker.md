---
layout: default
title: 关于Docker的一些思考
---


# 关于Docker和k8s的一些思考

### 为什么Docker和k8s这么流行？
最近面试几名同学，都问了一个问题，为什么Docker和k8s现在这么流行？它们解决了哪些痛点？想听听应聘者如何看待新技术，对于新技术有哪些思考。

很多同学的回答：

1. 有Docker可以方便线上升级，直接部署相应的image即可。
2. 配合容器编排，可以更容易地扩容，对于无状态服务，实现高可用。

这些回答都很对，但是似乎没有回答到点儿上。在容器流行之前没有自动交付(Continuous Deliver)系统完成自动化部署吗？容器流行之前，Hadoop，Spark，Storm已经可以提供成熟的分布式系统；ZooKeeper作为成熟的分布式协调者，可以帮助开发者实现高可用的系统。

Docker不是什么新技术，各家也都有自己实现的linux隔离技术。从各大互联网会议就可以看出，Docker，容器编排和微服务已经发展成互联网公司必备的技术和实践。那么Docker到底帮我们解决了哪些问题呢？



### Docker解决的问题
隔离是Docker最重要的特性之一。Docker（配合k8s）的诸多特点都是基于隔离特性的。

* Docker能够将应用程序与基础架构分离，从而可以快速交付软件。业务开发的同学更多关注容器内应用的开发，架构开发的同学可以把精力放在基于Docker架构设计和k8s使用上。
* 从分布式的角度来说，资源和调度的分离有利于提高资源利用率，提高软件可用性。Docker恰好提供这样的功能，帮助实现分布式系统。

Docker还有其他便利之处：

* Docker之前的自动化部署工具多是现有架构的补充（比如salt，puppet），集群中每台机器都启动工具的服务，完成部署功能。k8s的出现统一了架构设计和部署的鸿沟，在架构设计开始阶段就提供标准化的部署方式。
* 组织部门的扩大使得软件开发和维护成本大大增加。微服务不仅是一种架构设计方式，也是组织管理方式。微服务的流行也让Docker和k8s曝光率大大增加。


### Docker & 虚拟机
虚拟机也可以提供隔离的功能。他们之间的对比：

|  | 隔离性 | 资源配额 | 移动性 | 安全性 |
| ------| ------ | ------ | ------ | ------ | 
| VM | 虚拟机运行 | 硬件虚拟化CPU，Memory | Image, snapshot, 容忍机器异构，移动性好 | 虚拟机空间运行，安全性高 |
| Docker | LXC+虚拟化 | cgroup | Image, 自包含不依赖环境 | 	基于namespace |

### 代码重用层面的思考
从程序设计方法学角度来思考，代码复用有几种：

1. 程序库，代码实现的复用
2. 设计模式，抽象类和接口的复用
3. 应用框架，使用特定场景和范围，架构的复用

程序员秉承Don't repeat yourself的原则，喜欢抽象归纳，把相同的事情标准化统一化，减少开发成本和出错的风险。

前两点更多是代码层面的复用，应用框架则是基于具体的业务场景抽象出解决问题的通用方法。比如分布式系统和高可用的普及带来Hadoop，Spark等平台，日志处理问题也衍生了Storm流式计算框架。那么Docker和k8s带来哪些变化呢？

之前的应用框架更多是基于某一具体的业务场景，比如日志分析处理而诞生的。Docker和k8s提供了一套通用的基础框架，用同一套标准，可以实现多种多样的架构。标准就是容器，就是pod，service，RC等。把业务应用对应到容器内部，使用k8s开发系统架构，同时享受k8s社区的监控，日志功能，减少开发成本。

那么接下来代码重用会有什么进步呢？我猜测一个方向就是容器设计模式。有个docker和k8s提供的标准之后，各种业务场景都会诞生通用的容器架构模式，比如日志处理，设计（Feed流），支付等。


